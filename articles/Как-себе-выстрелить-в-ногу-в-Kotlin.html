<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Как себе выстрелить в ногу в Kotlin</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link rel='stylesheet' href='./styles.css'>
  <link href='https://fonts.googleapis.com/css?family=Anonymous+Pro:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600' rel='stylesheet' type='text/css'>
  <script src="undefined"></script>
</head>
<body>
<div id="layout" class="layout">
  <header class="article-nav">
    <button class="menu-link">
      <!-- Hamburger icon -->
      <span></span>
    </button>
    <div class="article-nav-links">
      <a href="The-Journey-of-a-Spring-Boot-application-from-Java-8-to-Kotlin-part-3-Data-Classes.html" class="article-nav-link article-nav-link--prev">previous</a>
      <a href="Kotlin-and-Ceylon.html" class="article-nav-link article-nav-link--next">next</a>
    </div>
  </header>

  <aside id="menu" class="menu">
    <div class="pure-menu">
      <ul class="pure-menu-list">
        <li class="pure-menu-list-date">Sep 02, 2016</li><li><a href="./Building-DSL-Instead-of-an-IDE-Plugin.html">Building DSL Instead of an IDE Plugin</a></li>
<li class="pure-menu-list-date">Sep 01, 2016</li><li><a href="./Kotlin-census-call-to-action.html">Kotlin census: call to action</a></li>
<li class="pure-menu-list-date">Aug 31, 2016</li><li><a href="./Natural-testing-with-Kotlin.html">Natural testing with Kotlin</a></li>
<li><a href="./Writing-Kotlin-Idiomatic-Code.html">Writing Kotlin Idiomatic Code</a></li>
<li class="pure-menu-list-date">Aug 30, 2016</li><li><a href="./Ten-Kotlin-Features-To-Boost-Android-Development.html">Ten Kotlin Features To Boost Android Development </a></li>
<li><a href="./Getting-started-with-Kotlin-in-Android-development.html">Getting started with Kotlin in Android development</a></li>
<li><a href="./Kotlin-val-does-not-mean-immutable-it-just-means-readonly-yeah.html">Kotlin: val does not mean immutable, it just means readonly, yeah</a></li>
<li class="pure-menu-list-date">Aug 27, 2016</li><li><a href="./Improved-Pattern-Matching-in-Kotlin.html">Improved Pattern Matching in Kotlin</a></li>
<li class="pure-menu-list-date">Aug 21, 2016</li><li><a href="./Scala-vs-Kotlin-inline-and-infix.html">Scala vs Kotlin: inline and infix</a></li>
<li class="pure-menu-list-date">Aug 20, 2016</li><li><a href="./Decision-Trees-with-Kotlin.html">Decision Trees with Kotlin</a></li>
<li><a href="./Kotlin-The-Good-The-Bad-and-The-Ugly.html">Kotlin: The Good, The Bad, and The Ugly</a></li>
<li class="pure-menu-list-date">Aug 17, 2016</li><li><a href="./The-Next-Language-You-Thought-You-Didn’t-Need.html">The Next Language You Thought You Didn’t Need</a></li>
<li class="pure-menu-list-date">Aug 14, 2016</li><li><a href="./Logging-in-Kotlin-Android-AnkoLogger-vs-kotlin-logging.html">Logging in Kotlin & Android: AnkoLogger vs kotlin-logging</a></li>
<li class="pure-menu-list-date">Aug 10, 2016</li><li><a href="./PaperParcel-with-Kotlin.html">PaperParcel with Kotlin</a></li>
<li><a href="./Issues-Faced-With-Kotlin-During-Android-Development.html">Issues Faced With Kotlin During Android Development</a></li>
<li><a href="./Lessons-from-converting-an-app-to-100-Kotlin.html">Lessons from converting an app to 100% Kotlin</a></li>
<li class="pure-menu-list-date">Aug 06, 2016</li><li><a href="./The-Kobalt-diaries-Parallel-builds.html">The Kobalt diaries: Parallel builds</a></li>
<li class="pure-menu-list-date">Aug 05, 2016</li><li><a href="./Writing-Gradle-Build-Scripts-in-Kotlin.html">Writing Gradle Build Scripts in Kotlin</a></li>
<li><a href="./More-readable-tests-with-Kotlin.html">More readable tests with Kotlin</a></li>
<li class="pure-menu-list-date">Aug 04, 2016</li><li><a href="./Calling-on-EAPers.html">Calling on EAPers</a></li>
<li class="pure-menu-list-date">Aug 03, 2016</li><li><a href="./Better-Android-Development-with-Kotlin-and-Gradle.html">Better Android Development with Kotlin and Gradle</a></li>
<li><a href="./Andrey-Breslav-Kotlin-Coroutines-JVMLS-2016.html">Andrey Breslav: Kotlin Coroutines, JVMLS 2016</a></li>
<li class="pure-menu-list-date">Jul 28, 2016</li><li><a href="./KotlinLifeguard-1.html">KotlinLifeguard #1</a></li>
<li class="pure-menu-list-date">Jul 27, 2016</li><li><a href="./UI-Testing-separating-Assertions-from-Actions-with-Kotlin-DSL.html">UI Testing: separating Assertions from Actions with Kotlin DSL</a></li>
<li class="pure-menu-list-date">Jul 26, 2016</li><li><a href="./JUnit-5-with-Spring-Boot-plus-Kotlin.html">JUnit 5 with Spring Boot (plus Kotlin)</a></li>
<li class="pure-menu-list-date">Jul 25, 2016</li><li><a href="./Things-We-ve-Learned-During-Coolcal-Development-in-Kotlin.html">Things We've Learned During Coolcal Development in Kotlin</a></li>
<li class="pure-menu-list-date">Jul 24, 2016</li><li><a href="./Scala-vs-Kotlin-Operator-overloading.html">Scala vs Kotlin: Operator overloading</a></li>
<li class="pure-menu-list-date">Jul 14, 2016</li><li><a href="./First-glimpse-of-Kotlin-1-1-Coroutines-Type-aliases-and-more.html">First glimpse of Kotlin 1.1: Coroutines, Type aliases and more</a></li>
<li class="pure-menu-list-date">Jul 10, 2016</li><li><a href="./Scala-vs-Kotlin-Pimp-my-library.html">Scala vs Kotlin: Pimp my library</a></li>
<li class="pure-menu-list-date">Jul 06, 2016</li><li><a href="./Never-say-final-mocking-Kotlin-classes-in-unit-tests.html">Never say final: mocking Kotlin classes in unit tests</a></li>
<li class="pure-menu-list-date">Jul 03, 2016</li><li><a href="./Data-Driven-Testing-with-Spek.html">Data Driven Testing with Spek </a></li>
<li class="pure-menu-list-date">Jun 30, 2016</li><li><a href="./Kotlin-1-0-3-Is-Here.html">Kotlin 1.0.3 Is Here!</a></li>
<li class="pure-menu-list-date">Jun 25, 2016</li><li><a href="./How-to-get-IDEA-to-detect-kotlin-generated-sources-using-Gradle.html">How to get IDEA to detect kotlin generated sources using Gradle</a></li>
<li class="pure-menu-list-date">Jun 20, 2016</li><li><a href="./Ad-hoc-polymorphism-in-Kotlin.html">Ad-hoc polymorphism in Kotlin</a></li>
<li><a href="./Kotlin-null-safety-and-its-performance-considerations-part-1.html">Kotlin null safety and its performance considerations -- part 1</a></li>
<li class="pure-menu-list-date">Jun 17, 2016</li><li><a href="./Kotlin-Native.html">Kotlin Native</a></li>
<li class="pure-menu-list-date">Jun 14, 2016</li><li><a href="./Kotlin-Night-in-San-Francisco-Recordings.html">Kotlin Night in San Francisco Recordings</a></li>
<li><a href="./News-from-KotlinTest.html">News from KotlinTest</a></li>
<li class="pure-menu-list-date">Jun 13, 2016</li><li><a href="./Meet-the-Kotlin-Team-at-Gradle-Summit.html">Meet the Kotlin Team at Gradle Summit</a></li>
<li class="pure-menu-list-date">Jun 09, 2016</li><li><a href="./Архитектор-Kotlin-Язык-программирования-—-рабочий-инструмент-Если-никогда-их-не-менять-можно-отстать-от-жизни-.html">Архитектор Kotlin: «Язык программирования — рабочий инструмент. Если никогда их не менять, можно отстать от жизни» </a></li>
<li class="pure-menu-list-date">Jun 08, 2016</li><li><a href="./Kotlin-1-0-3-EAP.html">Kotlin 1.0.3 EAP</a></li>
<li class="pure-menu-list-date">Jun 06, 2016</li><li><a href="./When-Kotlin-met-Gradle.html">When Kotlin met Gradle</a></li>
<li class="pure-menu-list-date">Jun 03, 2016</li><li><a href="./Kotlin-Eclipse-Plugin-0-7-Is-Here.html">Kotlin Eclipse Plugin 0.7 Is Here!</a></li>
<li class="pure-menu-list-date">Jun 02, 2016</li><li><a href="./What’s-in-store-for-Kotlin-this-year.html">What’s in store for Kotlin this year</a></li>
<li class="pure-menu-list-date">Jun 01, 2016</li><li><a href="./Where-We-Stand-What-s-Next-for-Kotlin.html">Where We Stand & What's Next for Kotlin</a></li>
<li class="pure-menu-list-date">May 30, 2016</li><li><a href="./Neural-Networks-in-Kotlin-part-2.html">Neural Networks in Kotlin (part 2)</a></li>
<li class="pure-menu-list-date">May 27, 2016</li><li><a href="./Neural-Network-in-Kotlin.html">Neural Network in Kotlin</a></li>
<li class="pure-menu-list-date">May 24, 2016</li><li><a href="./You-can-do-Better-with-Kotlin.html">You can do Better with Kotlin</a></li>
<li class="pure-menu-list-date">May 20, 2016</li><li><a href="./Kotlin-dragging-java-into-the-modern-world.html">Kotlin, dragging java into the modern world</a></li>
<li class="pure-menu-list-date">May 18, 2016</li><li><a href="./Gradle-Meets-Kotlin.html">Gradle Meets Kotlin</a></li>
<li><a href="./Kotlin-Meets-Gradle.html">Kotlin Meets Gradle</a></li>
<li class="pure-menu-list-date">May 17, 2016</li><li><a href="./Gradle-Elevates-the-Build-to-First-Class-Programming-With-Kotlin-Language.html">Gradle Elevates the Build to First-Class Programming With Kotlin Language</a></li>
<li class="pure-menu-list-date">May 13, 2016</li><li><a href="./Kotlin-1-0-2-is-Here.html">Kotlin 1.0.2 is Here</a></li>
<li class="pure-menu-list-date">May 12, 2016</li><li><a href="./Kosent.html">Kosent</a></li>
<li class="pure-menu-list-date">May 10, 2016</li><li><a href="./Testing-in-Kotlin.html">Testing in Kotlin</a></li>
<li class="pure-menu-list-date">May 01, 2016</li><li><a href="./JMock-and-Kotlin.html">JMock and Kotlin</a></li>
<li class="pure-menu-list-date">Apr 29, 2016</li><li><a href="./Exercises-in-Kotlin-Part-5-Classes.html">Exercises in Kotlin: Part 5 - Classes</a></li>
<li class="pure-menu-list-date">Apr 27, 2016</li><li><a href="./Exercises-in-Kotlin-Part-4-Control-flows-and-return.html">Exercises in Kotlin: Part 4 - Control flows and return</a></li>
<li class="pure-menu-list-date">Apr 24, 2016</li><li><a href="./Writing-Concise-Code-With-Kotlin.html">Writing Concise Code With Kotlin</a></li>
<li><a href="./Type-safe-JavaFX-CSS-with-TornadoFX.html">Type safe JavaFX CSS with TornadoFX</a></li>
<li class="pure-menu-list-date">Apr 21, 2016</li><li><a href="./JDK7-8-features-in-Kotlin-1-0.html">JDK7/8 features in Kotlin 1.0</a></li>
<li><a href="./Kotlin-Android.html">Kotlin + Android</a></li>
<li class="pure-menu-list-date">Apr 20, 2016</li><li><a href="./Kotlin-Android-First-Impressions.html">Kotlin + Android First Impressions</a></li>
<li><a href="./Exercises-in-Kotlin-Part-3-Functions.html">Exercises in Kotlin: Part 3 - Functions</a></li>
<li class="pure-menu-list-date">Apr 19, 2016</li><li><a href="./Exercises-in-Kotlin-Part-2-High-level-syntax-and-Variables.html">Exercises in Kotlin: Part 2 - High level syntax and Variables</a></li>
<li class="pure-menu-list-date">Apr 18, 2016</li><li><a href="./Exercises-in-Kotlin-Part-1-Getting-Started.html">Exercises in Kotlin: Part 1 - Getting Started</a></li>
<li class="pure-menu-list-date">Apr 17, 2016</li><li><a href="./Code-improvements-with-Kotlin.html">Code improvements with Kotlin</a></li>
<li class="pure-menu-list-date">Apr 15, 2016</li><li><a href="./Few-thoughts-about-Kotlin-and-why-I-like-it-so-much.html">Few thoughts about Kotlin and why I like it so much</a></li>
<li class="pure-menu-list-date">Apr 14, 2016</li><li><a href="./Kotlin-for-Scala-Developers.html">Kotlin for Scala Developers</a></li>
<li><a href="./Kotlin-Post-1-0-Roadmap.html">Kotlin Post-1.0 Roadmap</a></li>
<li class="pure-menu-list-date">Apr 11, 2016</li><li><a href="./Making-Android-Development-Easier.html">Making Android Development Easier</a></li>
<li class="pure-menu-list-date">Apr 09, 2016</li><li><a href="./Keddit — Part-7-Infinite-Scroll-Higher-Order-functions-Lambdas.html">Keddit — Part 7: Infinite Scroll: Higher-Order functions & Lambdas</a></li>
<li><a href="./The-Kobalt-diaries-Automatic-Android-SDK-management.html">The Kobalt diaries: Automatic Android SDK management</a></li>
<li class="pure-menu-list-date">Apr 07, 2016</li><li><a href="./Android-And-Kotlin.html">Android And Kotlin</a></li>
<li class="pure-menu-list-date">Apr 06, 2016</li><li><a href="./Kotlin-Digest-2016-Q1.html">Kotlin Digest 2016.Q1</a></li>
<li><a href="./Kotlin-DSL-Anko.html">Kotlin DSL: Anko</a></li>
<li class="pure-menu-list-date">Apr 04, 2016</li><li><a href="./Kotlin-Practical-Experience.html">Kotlin: Practical Experience</a></li>
<li><a href="./Kotlin’s-killer-features.html">Kotlin’s killer features</a></li>
<li><a href="./Exploring-Delegation-in-Kotlin.html">Exploring Delegation in Kotlin</a></li>
<li class="pure-menu-list-date">Apr 03, 2016</li><li><a href="./Experimental-Kotlin-and-mutation-testing.html">Experimental: Kotlin and mutation testing</a></li>
<li class="pure-menu-list-date">Mar 31, 2016</li><li><a href="./10-Features-I-Wish-Java-Would-Steal-From-the-Kotlin-Language.html">10 Features I Wish Java Would Steal From the Kotlin Language</a></li>
<li class="pure-menu-list-date">Mar 30, 2016</li><li><a href="./Ubuntu-Make-16-03-Released-With-Eclipse-JEE-And-IntelliJ-IDEA-EAP-Support-More.html">Ubuntu Make 16.03 Released With Eclipse JEE And IntelliJ IDEA EAP Support, More</a></li>
<li><a href="./Kotlin’s-Android-Roadmap.html">Kotlin’s Android Roadmap</a></li>
<li class="pure-menu-list-date">Mar 29, 2016</li><li><a href="./Rest-API-plumbing-with-kotlin.html">Rest API plumbing with kotlin</a></li>
<li class="pure-menu-list-date">Mar 28, 2016</li><li><a href="./Creating-an-AndroidWear-watchface-using-Kotlin.html">Creating an AndroidWear watchface using Kotlin</a></li>
<li class="pure-menu-list-date">Mar 22, 2016</li><li><a href="./Writing-a-RESTful-backend-using-Kotlin-and-Spring-Boot.html">Writing a RESTful backend using Kotlin and Spring Boot</a></li>
<li><a href="./How-to-Hot-Deploy-Java-Kotlin-classes-in-Dev.html">How to Hot Deploy Java/Kotlin classes in Dev</a></li>
<li><a href="./RU-Андрей-Бреслав-и-Дмитрий-Жемеров-о-Kotlin-1-0-на-jug-msk-ru.html">(RU) Андрей Бреслав и Дмитрий Жемеров о Kotlin 1.0 на jug.msk.ru</a></li>
<li class="pure-menu-list-date">Mar 20, 2016</li><li><a href="./A-Geospatial-Messenger-with-Kotlin-Spring-Boot-and-PostgreSQL.html">A Geospatial Messenger with Kotlin, Spring Boot and PostgreSQL</a></li>
<li class="pure-menu-list-date">Mar 19, 2016</li><li><a href="./Algebraic-Data-Types-In-Kotlin.html">Algebraic Data Types In Kotlin</a></li>
<li><a href="./Kotlin-Month-Post-4-Properties.html">Kotlin Month Post 4: Properties</a></li>
<li class="pure-menu-list-date">Mar 17, 2016</li><li><a href="./Kotlin-Educational-Plugin.html">Kotlin Educational Plugin</a></li>
<li class="pure-menu-list-date">Mar 16, 2016</li><li><a href="./Using-Kotlin-For-Tests-in-Android.html">Using Kotlin For Tests in Android</a></li>
<li><a href="./Kotlin-1-0-1-is-Here.html">Kotlin 1.0.1 is Here!</a></li>
<li><a href="./Kotlin-recipes-for-Android-I-OnGlobalLayoutListener.html">Kotlin recipes for Android (I): OnGlobalLayoutListener</a></li>
<li class="pure-menu-list-date">Mar 15, 2016</li><li><a href="./Kotlin-Retrofit-RxAndroid-Realm.html">Kotlin : Retrofit + RxAndroid + Realm</a></li>
<li class="pure-menu-list-date">Mar 14, 2016</li><li><a href="./Kotlin-Android-A-Brass-Tacks-Experiment-Wrap-Up.html">Kotlin & Android: A Brass Tacks Experiment Wrap-Up</a></li>
<li class="pure-menu-list-date">Mar 13, 2016</li><li><a href="./Kotlin-Month-Post-3-Safety.html">Kotlin Month Post 3: Safety</a></li>
<li><a href="./Feedback-on-the-Josephus-problem.html">Feedback on the Josephus problem</a></li>
<li class="pure-menu-list-date">Mar 11, 2016</li><li><a href="./RU-SDCast-41-в-гостях-Андрей-Бреслав-руководитель-проекта-Kotlin-в-компании-JetBrains.html">(RU) SDCast #41: в гостях Андрей Бреслав, руководитель проекта Kotlin в компании JetBrains</a></li>
<li><a href="./Why-I-don-t-want-to-use-Kotlin-for-Android-Development-yet.html">Why I don't want to use Kotlin for Android Development yet</a></li>
<li class="pure-menu-list-date">Mar 09, 2016</li><li><a href="./Getting-Started-with-Kotlin-and-Anko-on-Android.html">Getting Started with Kotlin and Anko on Android</a></li>
<li><a href="./RU-Дмитрий-Полищук-Kotlin-Android-практический-ликбез.html">(RU) Дмитрий Полищук - Kotlin + Android: практический ликбез</a></li>
<li class="pure-menu-list-date">Mar 08, 2016</li><li><a href="./A-DSL-Workbench-with-Gradle-and-Kotlin.html">A DSL Workbench with Gradle and Kotlin</a></li>
<li><a href="./Kotlin-Android-A-Brass-Tacks-Experiment-Part-6.html">Kotlin & Android: A Brass Tacks Experiment, Part 6</a></li>
<li class="pure-menu-list-date">Mar 06, 2016</li><li><a href="./Solving-the-Josephus-problem-in-Kotlin.html">Solving the Josephus problem in Kotlin</a></li>
<li class="pure-menu-list-date">Mar 05, 2016</li><li><a href="./Kotlin-Month-Post-2-Inheritance-and-Defaults.html">Kotlin Month Post 2: Inheritance and Defaults</a></li>
<li class="pure-menu-list-date">Mar 04, 2016</li><li><a href="./Building-a-Kotlin-project-2-2.html">Building a Kotlin project 2/2</a></li>
<li><a href="./Building-a-Kotlin-project-1-2.html">Building a Kotlin project 1/2</a></li>
<li><a href="./RU-Видео-со-встречи-JUG-ru-с-разработчиками-Kotlin.html">(RU) Видео со встречи JUG.ru с разработчиками Kotlin</a></li>
<li class="pure-menu-list-date">Mar 03, 2016</li><li><a href="./Kotlin-a-new-JVM-language-you-should-try.html">Kotlin: a new JVM language you should try</a></li>
<li class="pure-menu-list-date">Mar 02, 2016</li><li><a href="./RU-Kotlin-для-начинающих.html">(RU) Kotlin для начинающих</a></li>
<li class="pure-menu-list-date">Mar 01, 2016</li><li><a href="./Kotlin-Android-A-Brass-Tacks-Experiment-Part-5.html">Kotlin & Android: A Brass Tacks Experiment, Part 5</a></li>
<li><a href="./Developing-on-Android-sucks-a-lot-less-with-Kotlin.html">Developing on Android sucks a lot less with Kotlin</a></li>
<li class="pure-menu-list-date">Feb 29, 2016</li><li><a href="./The-Journey-of-a-Spring-Boot-application-from-Java-8-to-Kotlin-part-3-Data-Classes.html">The Journey of a Spring Boot application from Java 8 to Kotlin, part 3: Data Classes</a></li>
<li><a href="./Как-себе-выстрелить-в-ногу-в-Kotlin.html">Как себе выстрелить в ногу в Kotlin</a></li>
<li class="pure-menu-list-date">Feb 28, 2016</li><li><a href="./Kotlin-and-Ceylon.html">Kotlin and Ceylon</a></li>
<li class="pure-menu-list-date">Feb 27, 2016</li><li><a href="./Kotlin-Month-Post-1-Assorted-Features.html">Kotlin Month Post 1: Assorted Features</a></li>
<li class="pure-menu-list-date">Feb 24, 2016</li><li><a href="./Kotlin-2-Years-On.html">Kotlin - 2 Years On</a></li>
<li class="pure-menu-list-date">Feb 23, 2016</li><li><a href="./The-Journey-of-a-Spring-Boot-application-from-Java-8-to-Kotlin-part-2-Configuration-Classes.html">The Journey of a Spring Boot application from Java 8 to Kotlin, part 2: Configuration Classes</a></li>
<li><a href="./An-Introduction-to-Kotlin.html">An Introduction to Kotlin</a></li>
<li><a href="./Kotlin-1-0-is-finally-released.html">Kotlin 1.0 is finally released!</a></li>
<li class="pure-menu-list-date">Feb 22, 2016</li><li><a href="./More-Kotlin-Features-to-Love.html">More Kotlin Features to Love</a></li>
<li><a href="./A-Very-Peculiar-but-Possibly-Cunning-Kotlin-Language-Feature.html">A Very Peculiar, but Possibly Cunning Kotlin Language Feature.</a></li>
<li><a href="./Kotlin-Easily-storing-a-list-in-SharedPreferences-with-Custom-Accessors.html">Kotlin: Easily storing a list in SharedPreferences with Custom Accessors</a></li>
<li class="pure-menu-list-date">Feb 21, 2016</li><li><a href="./Kotlin — Love-at-first-line.html">Kotlin — Love at first line</a></li>
<li class="pure-menu-list-date">Feb 20, 2016</li><li><a href="./RU-Радио-Т-484.html">(RU) Радио-Т 484</a></li>
<li><a href="./RU-DevZen-Podcast-Kotlin-и-Vulkan-1-0-—-Episode-0080.html">(RU) DevZen Podcast: Kotlin и Vulkan 1.0 — Episode 0080.</a></li>
<li><a href="./The-Kobalt-diaries-testing.html">The Kobalt diaries: testing</a></li>
<li><a href="./RU-Немного-о-Kotlin.html">(RU) Немного о Kotlin.</a></li>
<li><a href="./Using-Mockito-for-unit-testing-with-Kotlin-1-x.html">Using Mockito for unit testing with Kotlin (1/x)</a></li>
<li><a href="./Weekend-resources-for-new-Kotlin-programmers.html">Weekend resources for new Kotlin programmers</a></li>
<li class="pure-menu-list-date">Feb 19, 2016</li><li><a href="./RU-Kotlin-1-0-Задай-вопрос-команде.html">(RU) Kotlin 1.0. Задай вопрос команде.</a></li>
<li class="pure-menu-list-date">Feb 16, 2016</li><li><a href="./Kotlin-Android-A-Brass-Tacks-Experiment-Part-3.html">Kotlin & Android: A Brass Tacks Experiment, Part 3.</a></li>
<li><a href="./Kotlin-1-0-The-good-the-bad-and-the-evident.html">Kotlin 1.0: The good, the bad and the evident.</a></li>
<li><a href="./RU-Релиз-Kotlin-1-0-языка-программирования-для-JVM-и-Android.html">(RU) Релиз Kotlin 1.0, языка программирования для JVM и Android.</a></li>
<li class="pure-menu-list-date">Feb 15, 2016</li><li><a href="./JVM-Newcomer-Kotlin-1-0-is-GA.html">JVM Newcomer Kotlin 1.0 is GA</a></li>
<li><a href="./Developing-Spring-Boot-applications-with-Kotlin.html">Developing Spring Boot applications with Kotlin.</a></li>
<li><a href="./Kotlin-1-0-Released-Pragmatic-Language-for-JVM-and-Android.html">Kotlin 1.0 Released: Pragmatic Language for JVM and Android</a></li>
<li class="pure-menu-list-date">Feb 13, 2016</li><li><a href="./The-Journey-of-a-Spring-Boot-application-from-Java-8-to-Kotlin-The-Application-Class.html">The Journey of a Spring Boot application from Java 8 to Kotlin: The Application Class</a></li>
<li class="pure-menu-list-date">Feb 04, 2016</li><li><a href="./RU-Podcast-Разбор-Полетов-Episode-102-—-Kotlin-тесты-и-здоровый-сон.html">(RU) Podcast Разбор Полетов: Episode 102 — Kotlin, тесты и здоровый сон.</a></li>
<li><a href="./Kotlin-Android-A-Brass-Tacks-Experiment-Part-4.html">Kotlin & Android: A Brass Tacks Experiment, Part 4</a></li>
<li><a href="./Kotlin-1-0-Release-Candidate-is-Out.html">Kotlin 1.0 Release Candidate is Out!</a></li>
<li class="pure-menu-list-date">Feb 03, 2016</li><li><a href="./Kotlin-Coding.html">Kotlin Coding</a></li>
<li class="pure-menu-list-date">Feb 02, 2016</li><li><a href="./10-Kotlin-Tutorials-for-Beginners-Dive-Into-Kotlin-Programming.html">10 Kotlin Tutorials for Beginners: Dive Into Kotlin Programming</a></li>
<li class="pure-menu-list-date">Feb 01, 2016</li><li><a href="./Kotlin-Android-A-Brass-Tacks-Experiment-Part-2.html">Kotlin & Android: A Brass Tacks Experiment, Part 2.</a></li>
<li><a href="./Kotlin-Android-A-Brass-Tacks-Experiment-Part-1.html">Kotlin & Android: A Brass Tacks Experiment, Part 1.</a></li>
<li><a href="./Scala-vs-Kotlin.html">Scala vs Kotlin</a></li>
<li class="pure-menu-list-date">Jan 25, 2016</li><li><a href="./KillerTask-the-solution-to-AsyncTask-implementation.html">KillerTask, the solution to AsyncTask implementation</a></li>
<li class="pure-menu-list-date">Jan 23, 2016</li><li><a href="./My-Kotlin-Adventure.html">My Kotlin Adventure</a></li>
<li class="pure-menu-list-date">Jan 16, 2016</li><li><a href="./Mimicking-Kotlin-Builders-in-Java-and-Python.html">Mimicking Kotlin Builders in Java and Python</a></li>
<li class="pure-menu-list-date">Jan 15, 2016</li><li><a href="./Android-development-with-Kotlin.html">Android development with Kotlin</a></li>
<li><a href="./Kotlin-the-somewhat-obscure-modern-Android-friendly-programming-language.html">Kotlin, the somewhat obscure modern Android-friendly programming language</a></li>
<li class="pure-menu-list-date">Jan 14, 2016</li><li><a href="./Fun-with-Kotlin.html">Fun with Kotlin</a></li>
<li class="pure-menu-list-date">Jan 10, 2016</li><li><a href="./Playing-with-Spring-Boot-Vaadin-and-Kotlin.html">Playing with Spring Boot, Vaadin and Kotlin</a></li>
<li class="pure-menu-list-date">Jan 06, 2016</li><li><a href="./Kotlin-XML-Binding.html">Kotlin XML Binding</a></li>
<li class="pure-menu-list-date">Dec 30, 2015</li><li><a href="./Early-Impressions-of-Kotlin.html">Early Impressions of Kotlin</a></li>
<li class="pure-menu-list-date">Dec 12, 2015</li><li><a href="./Kotlin-for-Java-Developers-10-Features-You-Will-Love-About-Kotlin.html">Kotlin for Java Developers: 10 Features You Will Love About Kotlin</a></li>
<li class="pure-menu-list-date">Nov 11, 2015</li><li><a href="./Setting-up-Kotlin-with-Android-and-tests.html">Setting up Kotlin with Android and tests</a></li>
<li class="pure-menu-list-date">Nov 05, 2015</li><li><a href="./Functional-Programming-with-Kotlin.html">Functional Programming with Kotlin</a></li>
<li class="pure-menu-list-date">Oct 30, 2015</li><li><a href="./Exploring-the-Kotlin-standard-library.html">Exploring the Kotlin standard library</a></li>
<li class="pure-menu-list-date">Oct 22, 2015</li><li><a href="./Kotlin-NoSQL-for-MongoDB-in-Action.html">Kotlin NoSQL for MongoDB in Action</a></li>
<li class="pure-menu-list-date">Sep 21, 2015</li><li><a href="./Quasar-Efficient-and-Elegant-Fibers-Channels-and-Actors.html">Quasar: Efficient and Elegant Fibers, Channels and Actors</a></li>
<li class="pure-menu-list-date">Sep 18, 2015</li><li><a href="./Kotlin-❤-FP.html">Kotlin ❤ FP</a></li>
<li class="pure-menu-list-date">Aug 26, 2015</li><li><a href="./Production-Ready-Kotlin.html">Production Ready Kotlin</a></li>
<li class="pure-menu-list-date">Aug 12, 2015</li><li><a href="./JVMLS-2015-Flexible-Types-in-Kotlin.html">JVMLS 2015 - Flexible Types in Kotlin</a></li>
<li class="pure-menu-list-date">Aug 06, 2015</li><li><a href="./Building-APIs-on-the-JVM-Using-Kotlin-and-Spark-–-Part-1.html">Building APIs on the JVM Using Kotlin and Spark – Part 1</a></li>
<li class="pure-menu-list-date">Jul 31, 2015</li><li><a href="./RU-Без-слайдов-интервью-с-Дмитрием-Жемеровым-из-JetBrains.html">(RU) Без слайдов: интервью с Дмитрием Жемеровым из JetBrains</a></li>
<li class="pure-menu-list-date">Jul 20, 2015</li><li><a href="./Android-Kotlin-3.html">Android + Kotlin = <3</a></li>
<li class="pure-menu-list-date">Jul 06, 2015</li><li><a href="./Why-Kotlin-is-my-next-programming-language.html">Why Kotlin is my next programming language</a></li>
<li class="pure-menu-list-date">Jun 27, 2015</li><li><a href="./Exploring-Kotlin.html">Exploring Kotlin</a></li>
<li><a href="./RxAndroid-and-Kotlin-Part-1.html">RxAndroid and Kotlin (Part 1)</a></li>
<li class="pure-menu-list-date">Jun 04, 2015</li><li><a href="./Quasar-and-Kotlin-a-Powerful-Match.html">Quasar and Kotlin - a Powerful Match</a></li>
<li class="pure-menu-list-date">May 09, 2015</li><li><a href="./Kotlin-New-Hope-in-a-Java-6-Wasteland.html">Kotlin: New Hope in a Java 6 Wasteland</a></li>
<li class="pure-menu-list-date">Dec 11, 2014</li><li><a href="./Kotlin-for-Java-developers.html">Kotlin for Java developers</a></li>
<li class="pure-menu-list-date">Dec 01, 2014</li><li><a href="./Non-trivial-constructors-in-Kotlin.html">Non-trivial constructors in Kotlin</a></li>
<li class="pure-menu-list-date">Nov 03, 2014</li><li><a href="./GeeCON-Prague-2014-Andrey-Cheptsov-A-Reactive-and-Type-safe-Kotlin-DSL-for-NoSQL-and-SQL.html">GeeCON Prague 2014: Andrey Cheptsov - A Reactive and Type-safe Kotlin DSL for NoSQL and SQL</a></li>
<li class="pure-menu-list-date">Sep 10, 2014</li><li><a href="./Kotlin-vs-Java-puzzlers.html">Kotlin vs Java puzzlers</a></li>
<li class="pure-menu-list-date">Apr 02, 2013</li><li><a href="./The-Advent-of-Kotlin-A-Conversation-with-JetBrains-Andrey-Breslav.html">The Advent of Kotlin: A Conversation with JetBrains' Andrey Breslav</a></li>
<li class="pure-menu-list-date">Feb 07, 2013</li><li><a href="./Exploring-the-Kotlin-Standard-Library-Part-3.html">Exploring the Kotlin Standard Library - Part 3</a></li>
<li class="pure-menu-list-date">Jan 25, 2013</li><li><a href="./Exploring-the-Kotlin-Standard-Library-Part-2.html">Exploring the Kotlin Standard Library - Part 2</a></li>
<li class="pure-menu-list-date">Jan 23, 2013</li><li><a href="./The-Adventurous-Developer’s-Guide-to-JVM-languages-–-Kotlin.html">The Adventurous Developer’s Guide to JVM languages – Kotlin</a></li>
<li class="pure-menu-list-date">Jan 22, 2013</li><li><a href="./Exploring-the-Kotlin-Standard-Library-Part-1.html">Exploring the Kotlin Standard Library - Part 1</a></li>
      </ul>
    </div>
  </aside>

  <section id="main" class="main">
    <div class="main-content">
      <h1>
        <a href="https://habrahabr.ru/post/278169/">Как себе выстрелить в ногу в Kotlin</a> - <span class="main-title-date">Feb 29, 2016</span>
      </h1>
      <h2>by @ov7a</h2>
      <blockquote>
<p>Пост-наброс</p>
</blockquote>
<h2>Как себе выстрелить в ногу в Kotlin</h2>
<p>Совсем недавно вышел <a href="http://blog.jetbrains.com/kotlin/2016/02/kotlin-1-0-released-pragmatic-language-for-jvm-and-android/">релиз</a> Kotlin, а его команда разработчиков предлагала <a href="https://habrahabr.ru/company/JetBrains/blog/277573/">задавать вопросы</a> про язык. Он сейчас на слуху и, возможно, многим хочется его попробовать.</p>
<p>Пару недель назад тимлид сделал для компании презентацию о том, что в Котлине хорошо. Одним из самых интересных вопросов был «А как в Котлине выстрелить себе в ногу?» Так получилось, что ответил на этот вопрос я.</p>
<p>Disclaimer:
Не стоит воспринимать эту статью как «Kotlin — отстой». Хотя я отношусь скорее к категории тех, кому и со Scala хорошо, я считаю, что язык неплохой.
Все пункты спорные, но раз в год и палка стреляет. Когда-то вы себе прострелите заодно и башку, а когда-то у вас получится выстрелить только в полночь полнолуния, если вы предварительно совершите черный ритуал создания плохого кода.</p>
<p>Наша команда недавно закончила большой проект на Scala, сейчас делаем проект помельче на Kotlin, поэтому в спойлерах будет сравнение со Scala. Я буду считать, что Nullable в Kotlin — это эквивалент Option, хотя это совсем не так, но, скорее всего, большинство из тех, кто работал с Option, будут вместо него использовать Nullable.</p>
<h4>1. Пост-инкремент и преинкремент как выражения</h4>
<p>Цитирую вопрошавшего: «Фу, это ж баян, скучно». Столько копий сломано, миллион вопросов на собеседованиях C++... Если есть привычка, то можно было его оставить инструкцией (statement'ом). Справедливости ради, другие операторы, вроде +=, являются инструкциями.
<a href="https://habrahabr.ru/company/JetBrains/blog/277573/#comment_8784811">Цитирую</a> одного из разработчиков, <a href="https://habrahabr.ru/users/abreslav/">abreslav</a>:</p>
<blockquote>
<p>Смотрели на юзкейсы, увидели, что поломается, решили оставить.</p>
<p>Замечу, что у нас тут не С++, и на собеседовании про инкремент спросить особо нечего. Разве что разницу между префиксным и постфиксным.</p>
</blockquote>
<p>На нет и суда нет. Разумеется, в здравом уме никто так делать не будет, но случайно — может быть.</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">var</span> i = <span class="hljs-number">5</span>
i = i++ + i++
println(i)</code></pre>
<blockquote>
<p><strong>Никакого undefined behaviour, результат, очевидно, 12</strong></p>
<p>11</p>
</blockquote>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">var</span> a = <span class="hljs-number">5</span>
a = ++a + ++a
println(a)</code></pre>
<blockquote>
<p><strong>Тут все проще, конечно, 14</strong></p>
<p>13</p>
</blockquote>
<blockquote>
<p><strong>Больше примеров</strong></p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">var</span> b = <span class="hljs-number">5</span>
b = ++b + b++
println(b)</code></pre>
<blockquote>
<p><strong>Банальная логика говорит, что ответ должен быть между 11 и 13</strong></p>
<p>да, 12</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">var</span> c = <span class="hljs-number">5</span>
c = c++ + ++c
println(c)</code></pre>
</blockquote>
<blockquote>
<p><strong>От перестановки мест слагаемых сумма не меняется</strong></p>
<p>разумеется, 12</p>
</blockquote>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">var</span> d = <span class="hljs-number">5</span>
d = d + d++ + ++d + ++d
println(d)

<span class="hljs-keyword">var</span> e = <span class="hljs-number">5</span>
e = ++e + ++e + e++ + e
println(e)</code></pre>
<blockquote>
<p><strong>От перестановки мест слагаемых сумма не меняется!</strong></p>
<p>Разумеется:
25
28</p>
</blockquote>
</blockquote>
<blockquote>
<p><strong>Чё там в Scala?</strong></p>
<p>Ничего интересного, в Scala инкрементов нет. Компилятор скажет, что нет метода ++ для Int. Но если очень захотеть, его, конечно, можно определить.</p>
</blockquote>
<h4>2. Одобренный способ</h4>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">val</span> foo: <span class="hljs-built_in">Int</span>? = <span class="hljs-literal">null</span>
<span class="hljs-keyword">val</span> bar = foo!! + <span class="hljs-number">5</span></code></pre>
<blockquote>
<p><strong>Что хотели, то и получили</strong></p>
<p>Exception in thread «main» kotlin.KotlinNullPointerException</p>
</blockquote>
<p>В документации говорится, что так делать стоит только если вы очень хотите получить NullPointerException. Это хороший метод выстрелить себе в ногу: !! режет глаз и при первом взгляде на код все понятно. Разумеется, использование !! предполагается тогда, когда до этого вы проверили значение на null и smart cast по какой-нибудь причине не сработал. Или когда вы почему-то уверены, что там не может быть null.</p>
<blockquote>
<p><strong>Чё там в Scala?</strong></p>
<pre><code class="hljs language-scala"><span class="hljs-keyword">val</span> foo: <span class="hljs-type">Option</span>[<span class="hljs-type">Int</span>] = <span class="hljs-type">None</span>
<span class="hljs-keyword">val</span> bar = foo.get + <span class="hljs-number">5</span></code></pre>
<blockquote>
<p><strong>Что хотели, то и получили</strong></p>
<p>Exception in thread «main» java.util.NoSuchElementException: None.get</p>
</blockquote>
</blockquote>
<h4>3. Переопределение invoke()</h4>
<p>Начнем с простого: что делает этот кусок кода и какой тип у a?</p>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>(){...}
<span class="hljs-keyword">val</span> a = A()</code></pre>
<blockquote>
<p><strong>На глупый вопрос - глупый ответ</strong></p>
<p>Правильно, создает новый объект типа A, вызывая конструктор по умолчанию.</p>
</blockquote>
<p>А здесь что будет?</p>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> В <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span></span>(){...}
<span class="hljs-keyword">val</span> b = B()</code></pre>
<blockquote>
<p><strong>Ну, наверно, ошибка компиляции будет...</strong></p>
<p>А вот и нет!</p>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span></span>(){
    <span class="hljs-keyword">var</span> param = <span class="hljs-number">6</span>

    <span class="hljs-keyword">constructor</span>(a: <span class="hljs-built_in">Int</span>): <span class="hljs-keyword">this</span>(){
        param = a
    }

    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span>{
        <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">invoke</span><span class="hljs-params">()</span></span> = B(<span class="hljs-number">7</span>)
    }
}</code></pre>
<p>Для класса может быть определена фабрика. А если бы она была в классе A, то там все равно вызывался бы конструктор.</p>
</blockquote>
<p>Теперь вы ко всему готовы:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> С <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span></span>(){...}
<span class="hljs-keyword">val</span> c = C()</code></pre>
<blockquote>
<p><strong>Тут создается объект класса С через фабрику, определенную в объекте-компаньоне класса С.</strong></p>
<p>Конечно же нет!</p>
<pre><code class="hljs language-kotlin">    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span></span>(){
        ...
        <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span>{
            <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">invoke</span><span class="hljs-params">()</span></span> = A(<span class="hljs-number">9</span>)
        }
    }</code></pre>
<p>У переменной c будет тип A. Заметьте, что A и С не связаны родственными узами.</p>
</blockquote>
<p><strong>Полный код</strong></p>
<blockquote>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>(){
    <span class="hljs-keyword">var</span> param = <span class="hljs-number">5</span>

    <span class="hljs-keyword">constructor</span>(a: <span class="hljs-built_in">Int</span>): <span class="hljs-keyword">this</span>(){
        param = a
    }

    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span>{
        <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">invoke</span><span class="hljs-params">()</span></span>= A(<span class="hljs-number">10</span>)
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span></span>(){
    <span class="hljs-keyword">var</span> param = <span class="hljs-number">6</span>

    <span class="hljs-keyword">constructor</span>(a: <span class="hljs-built_in">Int</span>): <span class="hljs-keyword">this</span>(){
        param = a
    }

    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span>{
        <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">invoke</span><span class="hljs-params">()</span></span> = B(<span class="hljs-number">7</span>)
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span></span>(){
    <span class="hljs-keyword">var</span> param = <span class="hljs-number">8</span>

    <span class="hljs-keyword">constructor</span>(a: <span class="hljs-built_in">Int</span>): <span class="hljs-keyword">this</span>(){
        param = a
    }

    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span>{
        <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">invoke</span><span class="hljs-params">()</span></span> = A(<span class="hljs-number">9</span>)
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">D</span></span>(){
    <span class="hljs-keyword">var</span> param = <span class="hljs-number">10</span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span>(a: <span class="hljs-built_in">Int</span>): <span class="hljs-keyword">this</span>(){
        param = a
    }

    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span>{
        <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">invoke</span><span class="hljs-params">(a: <span class="hljs-type">Int</span> = <span class="hljs-number">25</span>)</span></span> = D(a)
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">(args: <span class="hljs-type">Array</span>&#x3C;<span class="hljs-type">String</span>>)</span></span> {
    <span class="hljs-keyword">val</span> a = A()
    <span class="hljs-keyword">val</span> b = B()
    <span class="hljs-keyword">val</span> c = C()
    <span class="hljs-keyword">val</span> d = D()
    println(<span class="hljs-string">"<span class="hljs-subst">${a.javaClass}</span>, <span class="hljs-subst">${a.param}</span>"</span>)
    println(<span class="hljs-string">"<span class="hljs-subst">${b.javaClass}</span>, <span class="hljs-subst">${b.param}</span>"</span>)
    println(<span class="hljs-string">"<span class="hljs-subst">${c.javaClass}</span>, <span class="hljs-subst">${c.param}</span>"</span>)
    println(<span class="hljs-string">"<span class="hljs-subst">${d.javaClass}</span>, <span class="hljs-subst">${d.param}</span>"</span>)
}</code></pre>
<p>Результат выполнения:</p>
<p>class A, 5
class B, 7
class A, 9
class D, 10</p>
</blockquote>
<p>К сожалению, придумать короткий пример, где у вас реально все поломается, я не смог. Но пофантазировать немного можно. Если вы вернете левый класс, как в примере с классом C, то скорее всего, компилятор вас остановит. Но если вы никуда не передаете объект, то можно сымитировать утиную типизацию, как в примере. Ничего криминального, но человек, читающий код, может сойти с ума и застрелиться, если у него не будет исходника класса.</p>
<p>Если у вас есть наследование и функции для работы с базовым классом (Animal), а invoke() от одного наследника (Dog) вернет вам другого наследника (Duck), то тогда при проверке типов (Animal as Dog) вы можете накрякать себе беду.</p>
<blockquote>
<p><strong>Чё там в Scala?</strong></p>
<p>В Scala проще — есть new, который всегда вызывает конструктор. Если не будет new, то всегда вызывается метод apply у компаньона (который тоже может вернуть левый тип). Разумеется, если что-то вам не доступно из-за private, то компилятор ругнется. Все то же самое, только очевиднее.</p>
</blockquote>
<h4>4. lateinit</h4>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SlowPoke</span></span>(){
    lateinit <span class="hljs-keyword">var</span> value: String

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">test</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span>){ <span class="hljs-comment">//компилятор здесь говорит, что проверка не нужна (и правильно делает)</span>
            println(<span class="hljs-string">"null"</span>)
            <span class="hljs-keyword">return</span>
        }
        <span class="hljs-keyword">if</span> (value == <span class="hljs-string">"ololo"</span>)
            println(<span class="hljs-string">"ololo!"</span>)
        <span class="hljs-keyword">else</span>
            println(<span class="hljs-string">"alala!"</span>)
    }
}
SlowPoke().test()</code></pre>
<blockquote>
<p><strong>Результат предсказуем</strong></p>
<p>Exception in thread «main» kotlin.UninitializedPropertyAccessException: lateinit property value has not been initialized</p>
</blockquote>
<blockquote>
<p><strong>А как правильно?</strong></p>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SlowBro</span></span>(){
    <span class="hljs-keyword">val</span> value: String? = <span class="hljs-literal">null</span>

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">test</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span>) {
            println(<span class="hljs-string">"null"</span>)
            <span class="hljs-keyword">return</span>
        }
        <span class="hljs-keyword">if</span> (value == <span class="hljs-string">"ololo"</span>)
            println(<span class="hljs-string">"ololo!"</span>)
        <span class="hljs-keyword">else</span>
            println(<span class="hljs-string">"alala!"</span>)
    }
}
SlowBro().test()</code></pre>
<p><strong>Результат</strong></p>
<p>null</p>
</blockquote>
<p>Я бы сказал, что это тоже одобренный способ, но при чтении кода это неочевидно, в отличие от !!. В документации немного завуалированно говорится, что, мол, проверять не надо, если что, мы кинем тебе Exception. По идее, этот модификатор используется тогда, когда вы точно уверены, что поле будет инициализированно кем-то другим. То есть никогда. По моему опыту, все поля, которые были lateinit, рано или поздно стали Nullable. Неплохо это поле вписалось в контроллер JavaFX приложения, где Gui грузится из FXML, но даже это «железобетонное» решение было свергнуто после того, как появился альтернативный вариант без пары кнопок. Один раз так получилось, что в SceneBuilder изменил fx:id, а в коде забыл. В первые дни кодинга на Kotlin немного взбесило, что нельзя сделать lateinit Int. Я могу придумать, почему так сделали, но сомневаюсь, что совсем нет способа обойти эти причины (читай: сделать костыль).</p>
<blockquote>
<p><strong>Чё там в Scala?</strong></p>
<p>А там аналога lateinit как такового и нет. По крайней мере, я не обнаружил.</p>
</blockquote>
<h4>5. Конструктор</h4>
<blockquote>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IAmInHurry</span></span>(){
    <span class="hljs-keyword">val</span> param = initSecondParam()
    <span class="hljs-comment">/*tons of code*/</span>
    <span class="hljs-keyword">val</span> twentySecondParam = <span class="hljs-number">10</span>
    <span class="hljs-comment">/*tons of code*/</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">initSecondParam</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span>{
        println(<span class="hljs-string">"Initializing by default with <span class="hljs-subst">$twentySecondParam</span>"</span>)
        <span class="hljs-keyword">return</span> twentySecondParam
    }

}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IAmInHurryWithStrings</span></span>(){
    <span class="hljs-keyword">val</span> param = initSecondParam()
    <span class="hljs-comment">/*tons of code*/</span>
    <span class="hljs-keyword">val</span> twentySecondParam = <span class="hljs-string">"Default value of param"</span>
    <span class="hljs-comment">/*tons of code*/</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">initSecondParam</span><span class="hljs-params">()</span></span>: String{
        println(<span class="hljs-string">"Initializing by default with <span class="hljs-subst">$twentySecondParam</span>"</span>)
        <span class="hljs-keyword">return</span> twentySecondParam
    }
}
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">(args: <span class="hljs-type">Array</span>&#x3C;<span class="hljs-type">String</span>>)</span></span>{
    IAmInHurry()
    IAmInHurryWithStrings()
}</code></pre>
</blockquote>
<blockquote>
<p><strong>Результат</strong></p>
<p>Initializing by default with 0
Initializing by default with null</p>
</blockquote>
<p>Все просто — к полю идет обращение до того, как оно было инициализировано. Видимо, тут стоит немного доработать компилятор. По идее, если вы пишете код хорошо, такая проблема у вас не должна возникнуть, но всякое бывает, не с потолка же я взял этот пример (коллега себе так выстрелил в ногу, случайно через цепочку методов в редко срабатывающем коде вызвал поле, которое было не инициализировано).</p>
<blockquote>
<p><strong>Чё там в Scala?</strong></p>
<p>Все то же самое.</p>
<p>object Initializer extends App{
class IAmInHurry(){
val param = initSecondParam()
/<em>tons of code</em>/
val twentySecondParam = 10
/<em>tons of code</em>/
def initSecondParam(): Int = {
println(s"Initializing by default with $twentySecondParam")
twentySecondParam
}</p>
<p>  }</p>
<p>  class IAmInHurryWithStrings(){
val param = initSecondParam()
/<em>tons of code</em>/
val twentySecondParam = "Default value of param"
/<em>tons of code</em>/
def initSecondParam(): String = {
println(s"Initializing by default with $twentySecondParam")
twentySecondParam
}</p>
<p>  }</p>
<p>  override def main(args: Array[String]){
new IAmInHurry()
new IAmInHurryWithStrings()
}
}</p>
<p><strong>Результат</strong></p>
<p>Initializing by default with 0
Initializing by default with null</p>
</blockquote>
<h4>6. Взаимодействие с Java</h4>
<p>Для выстрела тут простор достаточно большой. Очевидное решение — считать все, что пришло из Java, Nullable. Но тут есть долгая и поучительная <a href="http://blog.jetbrains.com/kotlin/2015/04/upcoming-change-more-null-safety-for-java/">история</a>. Как я понял, она связана в основном с шаблонами, наследованием, и цепочкой Java-Kotlin-Java. И при таких сценариях приходилось делать много костылей, чтобы заработало. Поэтому решили от идеи «все Nullable» отказаться.
Но вроде как один из основных сценариев — свой код пишем на Kotlin, библиотели берем Java (как видится мне, простому крестьянину-кодеру). И при таком раскладе, лучше безопасность в большей части кода и явные костыли в небольшой части кода, которые видно, чем «красиво и удобно» + внезапные грабли в рантайме (или яма с кольями, как повезет). Но у разработчиков другое <a href="https://habrahabr.ru/company/JetBrains/blog/277573/#comment_8784731">мнение</a>:</p>
<blockquote>
<p>Одна из основных причин была в том, что писать на таком языке было неудобно, а читать его — неприятно. Повсюду вопросительные и восклицательные знаки, которые не очень-то помогают из-за того, что расставляются в основном, чтобы удовлетворить компилятор, а не чтобы корректно обработать случаи, когда выражение вычисляется в null. Особенно больно в случае дженериков: например, Map&#x3C;String?, String?>?..</p>
</blockquote>
<p>Сделаем небольшой класс на Java:</p>
<pre><code class="hljs language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JavaCopy</span> </span>{
    <span class="hljs-keyword">private</span> String a = <span class="hljs-keyword">null</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">JavaCopy</span><span class="hljs-params">()</span></span>{};

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">JavaCopy</span><span class="hljs-params">(String s)</span></span>{
        a = s;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">get</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">return</span> a;
    }
}</code></pre>
<p>И попробуем его вызвать из Kotlin:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printString</span><span class="hljs-params">(s: <span class="hljs-type">String</span>)</span></span> {
    println(s)
}

<span class="hljs-keyword">val</span> j1 = JavaCopy()
<span class="hljs-keyword">val</span> j1Got = j1.<span class="hljs-keyword">get</span>()
printString(j1Got)</code></pre>
<blockquote>
<p><strong>Результат</strong></p>
<p>Exception in thread «main» java.lang.IllegalStateException: j1Got must not be null</p>
</blockquote>
<p>Тип у j1 — String! и исключение мы получим только тогда, когда вызовем printString. Ок, давайте явно зададим тип:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">val</span> j2 = JavaCopy(<span class="hljs-string">"Test"</span>)
<span class="hljs-keyword">val</span> j3 = JavaCopy(<span class="hljs-literal">null</span>)

<span class="hljs-keyword">val</span> j2Got: String = j2.<span class="hljs-keyword">get</span>()
<span class="hljs-keyword">val</span> j3Got: String = j3.<span class="hljs-keyword">get</span>()

printString(j2Got)
printString(j3Got)</code></pre>
<blockquote>
<p><strong>Результат</strong></p>
<p>Exception in thread «main» java.lang.IllegalStateException: j3.get() must not be null</p>
</blockquote>
<p>Все логично. Когда мы явно указываем, что нам нужен NotNullable, тогда и ловим исключение. Казалось бы, указывай у всех переменных Nullable, и все будет хорошо. Но если делать так:</p>
<pre><code class="hljs language-kotlin">printString(j2.<span class="hljs-keyword">get</span>())</code></pre>
<p>то ошибку вы можете обнаружить нескоро.</p>
<blockquote>
<p><strong>Чё там в Scala?</strong></p>
<p>Никаких гарантий, NPE словить можно элементарно. Решение — оборачивать все в Option, у которого, напомню, есть хорошее свойство, что Option(null) = None. С другой стороны, тут нет иллюзий, что java interop безопасен.</p>
</blockquote>
<h4>7. infix нотация и лямбды</h4>
<p>Сделаем цепочку из методов и вызовем ее:</p>
<pre><code class="hljs language-kotlin">    <span class="hljs-function"><span class="hljs-keyword">fun</span><span class="hljs-type">&#x3C;R></span> <span class="hljs-title">first</span><span class="hljs-params">(func: ()</span></span> -> R): R{
        println(<span class="hljs-string">"calling first"</span>)
        <span class="hljs-keyword">return</span> func()
    }

    <span class="hljs-keyword">infix</span> <span class="hljs-function"><span class="hljs-keyword">fun</span><span class="hljs-type">&#x3C;R, T></span> R.<span class="hljs-title">second</span><span class="hljs-params">(func: (<span class="hljs-type">R</span>)</span></span> -> T): T{
        println(<span class="hljs-string">"calling second"</span>)
        <span class="hljs-keyword">return</span> func(<span class="hljs-keyword">this</span>)
    }

    first {
        println(<span class="hljs-string">"calling first body"</span>)
    }
    second {
        println(<span class="hljs-string">"calling second body"</span>)
    }</code></pre>
<p><strong>Результат</strong></p>
<pre><code class="hljs language-kotlin">calling first
calling first body
Oops!
calling second body</code></pre>
<p>Подождите-ка... тут какая-то подстава! И правда, «забыл» один метод вставить:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span><span class="hljs-type">&#x3C;T></span> <span class="hljs-title">second</span><span class="hljs-params">(func: ()</span></span> -> T): T{
    println(<span class="hljs-string">"Oops!"</span>)
    <span class="hljs-keyword">return</span> func()
}</code></pre>
<p>И чтобы заработало «как надо», нужно было написать так:</p>
<pre><code class="hljs language-kotlin">first {
    println(<span class="hljs-string">"calling first body"</span>)
} second {
    println(<span class="hljs-string">"calling second body"</span>)
}</code></pre>
<blockquote>
<p><strong>Результат</strong></p>
<p>calling first
calling first body
calling second
calling second body</p>
</blockquote>
<p>Всего один перенос строки, который легко при переформатировании удалить/добавить переключает поведение. Основано на реальных событиях: была цепочка методов «сделай в background» и «потом сделай в ui треде». И был метод «сделай в ui» с таким же именем.</p>
<blockquote>
<p><strong>Чё там в Scala?</strong></p>
<p>Синтаксис немного отличается, поэтому так просто тут себе не выстрелишь:</p>
<pre><code class="hljs language-scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Infix</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">App</span></span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">first</span></span>[<span class="hljs-type">R</span>](func: () => <span class="hljs-type">R</span>): <span class="hljs-type">R</span> = {
    println(<span class="hljs-string">"calling first"</span>)
    func()
  }

  <span class="hljs-keyword">implicit</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Second</span>[<span class="hljs-type">R</span>](<span class="hljs-params">val value: <span class="hljs-type">R</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">AnyVal</span></span>{
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">second</span></span>[<span class="hljs-type">T</span>](func: (<span class="hljs-type">R</span>) => <span class="hljs-type">T</span>): <span class="hljs-type">T</span> = {
      println(<span class="hljs-string">"calling second"</span>)
      func(value)
    }
  }

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">second</span></span>[<span class="hljs-type">T</span>](func: () => <span class="hljs-type">T</span>): <span class="hljs-type">T</span> = {
    println(<span class="hljs-string">"Oops!"</span>)
    func()
  }

  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]) {
    first { () =>
      println(<span class="hljs-string">"calling first body"</span>)
    } second { () => <span class="hljs-comment">//&#x3C;--------type mismach</span>
      println(<span class="hljs-string">"calling second body"</span>)
    }
  }
}</code></pre>
<p>Зато, пытаясь подогнать скаловский код хотя бы для неочевидности засчет implicit/underscore, я взорвал все вокруг.</p>
<blockquote>
<p><strong>Осторожно! Кровь, кишки и расчлененка...</strong></p>
<pre><code>object Infix2 extends App{
  def first(func: (Unit) => Unit): Unit = {
    println("calling first")
    func()
  }

  implicit class Second(val value: Unit) extends AnyVal{
    def second(func: (Unit) => Unit): Unit = {
      println("calling second")
      func(value)
    }
  }

  def second(func: (Unit) => Unit): Unit = {
    println("Oops!")
    func()
  }

  override def main(args: Array[String]) {
    first { _ =>
      println("calling first body")
    } second { _ =>
      println("calling second body")
    }
  }
}
</code></pre>
<p>И результат:</p>
<pre><code class="hljs language-scala"><span class="hljs-type">Exception</span> in thread <span class="hljs-string">"main"</span> java.lang.<span class="hljs-type">VerifyError</span>: <span class="hljs-type">Operand</span> stack underflow
<span class="hljs-type">Exception</span> <span class="hljs-type">Details</span>:
  <span class="hljs-type">Location</span>:
    <span class="hljs-type">Infix2</span>$<span class="hljs-type">Second</span>$.equals$extension(<span class="hljs-type">Lscala</span>/runtime/<span class="hljs-type">BoxedUnit</span>;<span class="hljs-type">Ljava</span>/lang/<span class="hljs-type">Object</span>;)<span class="hljs-type">Z</span> @<span class="hljs-number">40</span>: pop
  <span class="hljs-type">Reason</span>:
    <span class="hljs-type">Attempt</span> to pop empty stack.
  <span class="hljs-type">Current</span> <span class="hljs-type">Frame</span>:
    bci: @<span class="hljs-number">40</span>
    flags: { }
    locals: { <span class="hljs-symbol">'Infix2</span>$<span class="hljs-type">Second</span>/pre>, <span class="hljs-symbol">'scala</span>/runtime/<span class="hljs-type">BoxedUnit</span>', <span class="hljs-symbol">'java</span>/lang/<span class="hljs-type">Object</span>', <span class="hljs-symbol">'java</span>/lang/<span class="hljs-type">Object</span>', integer }
    stack: { }
  <span class="hljs-type">Bytecode</span>:
    <span class="hljs-number">0000000</span>: <span class="hljs-number">2</span>c4e <span class="hljs-number">2</span>dc1 <span class="hljs-number">0033</span> <span class="hljs-number">9900</span> <span class="hljs-number">0904</span> <span class="hljs-number">3604</span> a700 <span class="hljs-number">0603</span>
    <span class="hljs-number">0000010</span>: <span class="hljs-number">3604</span> <span class="hljs-number">1504</span> <span class="hljs-number">9900</span> <span class="hljs-number">4</span>d2c c700 <span class="hljs-number">0901</span> <span class="hljs-number">5701</span> a700
    <span class="hljs-number">0000020</span>: <span class="hljs-number">102</span>c c000 <span class="hljs-number">33</span>b6 <span class="hljs-number">0036</span> <span class="hljs-number">57</span>bb <span class="hljs-number">0038</span> <span class="hljs-number">59</span>bf <span class="hljs-number">3</span>a05
    <span class="hljs-number">0000030</span>: b200 <span class="hljs-number">1</span>f57 b200 <span class="hljs-number">1</span>fb2 <span class="hljs-number">001</span>f <span class="hljs-number">57</span>b2 <span class="hljs-number">001</span>f <span class="hljs-number">3</span>a06
    <span class="hljs-number">0000040</span>: <span class="hljs-number">59</span>c7 <span class="hljs-number">000</span>c <span class="hljs-number">5719</span> <span class="hljs-number">06</span>c6 <span class="hljs-number">000</span>e a700 <span class="hljs-number">0</span>f19 <span class="hljs-number">06</span>b6
    <span class="hljs-number">0000050</span>: <span class="hljs-number">003</span>c <span class="hljs-number">9900</span> <span class="hljs-number">0704</span> a700 <span class="hljs-number">0403</span> <span class="hljs-number">9900</span> <span class="hljs-number">0704</span> a700
    <span class="hljs-number">0000060</span>: <span class="hljs-number">0403</span> ac
  <span class="hljs-type">Stackmap</span> <span class="hljs-type">Table</span>:
    append_frame(@<span class="hljs-number">15</span>,<span class="hljs-type">Object</span>[#<span class="hljs-number">4</span>])
    append_frame(@<span class="hljs-number">18</span>,<span class="hljs-type">Integer</span>)
    same_frame(@<span class="hljs-number">33</span>)
    same_locals_1_stack_item_frame(@<span class="hljs-number">46</span>,<span class="hljs-type">Null</span>)
    full_frame(@<span class="hljs-number">77</span>,{<span class="hljs-type">Object</span>[#<span class="hljs-number">2</span>],<span class="hljs-type">Object</span>[#<span class="hljs-number">27</span>],<span class="hljs-type">Object</span>[#<span class="hljs-number">4</span>],<span class="hljs-type">Object</span>[#<span class="hljs-number">4</span>],<span class="hljs-type">Integer</span>,<span class="hljs-type">Null</span>,<span class="hljs-type">Object</span>[#<span class="hljs-number">27</span>]},{<span class="hljs-type">Object</span>[#<span class="hljs-number">27</span>]})
    same_frame(@<span class="hljs-number">85</span>)
    same_frame(@<span class="hljs-number">89</span>)
    same_locals_1_stack_item_frame(@<span class="hljs-number">90</span>,<span class="hljs-type">Integer</span>)
    chop_frame(@<span class="hljs-number">97</span>,<span class="hljs-number">2</span>)
    same_locals_1_stack_item_frame(@<span class="hljs-number">98</span>,<span class="hljs-type">Integer</span>)

    at <span class="hljs-type">Infix2</span>$.main(<span class="hljs-type">Infix</span>.scala)</code></pre>
</blockquote>
</blockquote>
<h4>8. Перегрузка методов и it</h4>
<p>Это, скорее, метод подгадить другим. Представьте, что вы пишите библиотеку, и в ней есть функция</p>
<pre><code class="hljs language-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">applier</span><span class="hljs-params">(x: <span class="hljs-type">String</span>, func: (<span class="hljs-type">String</span>)</span></span> -> <span class="hljs-built_in">Unit</span>){
    func(x)
}</code></pre>
<p>Разумеется, народ ее использует довольно прозрачным способом:</p>
<pre><code class="hljs language-kotlin">applier (<span class="hljs-string">"arg"</span>) {
    println(it)
}
applier (<span class="hljs-string">"no arg"</span>) {
    println(<span class="hljs-string">"ololo"</span>)
}</code></pre>
<p>Код компилируется, работает, все довольны. А потом вы добавляете метод</p>
<pre><code class="hljs language-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">applier</span><span class="hljs-params">(x: <span class="hljs-type">String</span>, func: ()</span></span> -> <span class="hljs-built_in">Unit</span>){
    println(<span class="hljs-string">"not applying <span class="hljs-subst">$x</span>"</span>)
    func()
}</code></pre>
<p>И чтобы компилятор не ругался, пользователям придется везде отказаться от it (читай: переписать кучу кода):</p>
<pre><code class="hljs language-kotlin">applier (<span class="hljs-string">"arg"</span>) { it -> <span class="hljs-comment">//FIXED</span>
    println(it)
}
applier (<span class="hljs-string">"no arg"</span>) { -> <span class="hljs-comment">//yes, explicit!</span>
    println(<span class="hljs-string">"ololo"</span>)
}</code></pre>
<p>Хотя, теоретически, компилятор мог бы и угадать, что если есть it, то это лямбда с 1 входным аргументом. Думаю, что с развитием языка и компилятор поумнеет, и этот пункт — временный.</p>
<blockquote>
<p><strong>Чё там в Scala?</strong></p>
<p>Без аргументов придется явно указать, что это лямбда. А при добавлении нового метода поведение не изменится.</p>
<pre><code class="hljs language-scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Its</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">App</span></span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">applier</span></span>(x: <span class="hljs-type">String</span>, func: (<span class="hljs-type">String</span>) => <span class="hljs-type">Unit</span>){
    func(x)
  }

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">applier</span></span>(x: <span class="hljs-type">String</span>, func: () => <span class="hljs-type">Unit</span>){
    println(<span class="hljs-string">"not applying $x"</span>)
    func()
  }

  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]) {
    applier(<span class="hljs-string">"arg"</span>, println(_))
    applier(<span class="hljs-string">"no arg"</span>, _ => println(<span class="hljs-string">"ololo"</span>))
  }
}</code></pre>
</blockquote>
<h4>9. Почему не стоит думать о Nullable как об Option</h4>
<p>Пусть у нас есть обертка для кэша:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cache</span>&#x3C;<span class="hljs-type">T</span>></span>(){
    <span class="hljs-keyword">val</span> elements: MutableMap&#x3C;String, T> = HashMap()

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">put</span><span class="hljs-params">(key: <span class="hljs-type">String</span>, elem: <span class="hljs-type">T</span>)</span></span> = elements.put(key, elem)

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">get</span><span class="hljs-params">(key: <span class="hljs-type">String</span>)</span></span> = elements[key]
}</code></pre>
<p>И простой сценарий использования:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">val</span> cache = Cache&#x3C;String>()
cache.put(<span class="hljs-string">"foo"</span>, <span class="hljs-string">"bar"</span>)

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getter</span><span class="hljs-params">(key: <span class="hljs-type">String</span>)</span></span> {
    cache.<span class="hljs-keyword">get</span>(key)?.let {
        println(<span class="hljs-string">"Got <span class="hljs-subst">$key</span> from cache: <span class="hljs-subst">$it</span>"</span>)
    } ?: println(<span class="hljs-string">"<span class="hljs-subst">$key</span> is not in cache!"</span>)
}

getter(<span class="hljs-string">"foo"</span>)
getter(<span class="hljs-string">"baz"</span>)</code></pre>
<blockquote>
<p><strong>Результат довольно предсказуем</strong></p>
<p>Got foo from cache: bar
baz is not in cache!</p>
</blockquote>
<p>Но если мы вдруг захотим к кэше хранить Nullable...</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">val</span> cache = Cache&#x3C;String?>()
cache.put(<span class="hljs-string">"foo"</span>, <span class="hljs-string">"bar"</span>)

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getter</span><span class="hljs-params">(key: <span class="hljs-type">String</span>)</span></span> {
    cache.<span class="hljs-keyword">get</span>(key)?.let {
        println(<span class="hljs-string">"Got <span class="hljs-subst">$key</span> from cache: <span class="hljs-subst">$it</span>"</span>)
    } ?: println(<span class="hljs-string">"<span class="hljs-subst">$key</span> is not in cache!"</span>)
}

getter(<span class="hljs-string">"foo"</span>)
getter(<span class="hljs-string">"baz"</span>)

cache.put(<span class="hljs-string">"IAmNull"</span>, <span class="hljs-literal">null</span>)
getter(<span class="hljs-string">"IAmNull"</span>)</code></pre>
<blockquote>
<p><strong>То получится не очень хорошо</strong></p>
<p>Got foo from cache: bar
baz is not in cache!
IAmNull is not in cache!</p>
</blockquote>
<p>Зачем хранить null? Например, чтобы показать, что результат не вычислим. Конечно, тут было бы правильнее использовать Option или Either, но, к сожалению, ни того, ни другого в стандартной библиотеке нет (но есть, например, в <a href="https://github.com/MarioAriasC/funKTionale/wiki">funKTionale</a>). Более того, как раз при реализации Either, я наступил на грабли этого пункта и предыдущего. Решить эту проблему с «двойным Nullable» можно, например, возвратом Pair или специального data class.</p>
<blockquote>
<p><strong>Чё там в Scala?</strong></p>
<p>Никто не запретит сделать Option от Option. Надеюсь, понятно, что так все будет хорошо. Да и с null тоже:</p>
<pre><code class="hljs language-scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">doubleNull</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">App</span></span>{
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cache</span>[<span class="hljs-type">T</span>]</span>{
    <span class="hljs-keyword">val</span> elements =  mutable.<span class="hljs-type">Map</span>.empty[<span class="hljs-type">String</span>, <span class="hljs-type">T</span>]

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">put</span></span>(key: <span class="hljs-type">String</span>, elem: <span class="hljs-type">T</span>) = elements.put(key, elem)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span></span>(key: <span class="hljs-type">String</span>) = elements.get(key)
  }

  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]) {
    <span class="hljs-keyword">val</span> cache = <span class="hljs-keyword">new</span> <span class="hljs-type">Cache</span>[<span class="hljs-type">String</span>]()
    cache.put(<span class="hljs-string">"foo"</span>, <span class="hljs-string">"bar"</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getter</span></span>(key: <span class="hljs-type">String</span>) {
      cache.get(key) <span class="hljs-keyword">match</span> {
        <span class="hljs-keyword">case</span> <span class="hljs-type">Some</span>(value) => println(<span class="hljs-string">s"Got <span class="hljs-subst">$key</span> from cache: <span class="hljs-subst">$value</span>"</span>)
        <span class="hljs-keyword">case</span> <span class="hljs-type">None</span> => println(<span class="hljs-string">s"<span class="hljs-subst">$key</span> is not in cache!"</span>)
      }
    }

    getter(<span class="hljs-string">"foo"</span>)
    getter(<span class="hljs-string">"baz"</span>)

    cache.put(<span class="hljs-string">"IAmNull"</span>, <span class="hljs-literal">null</span>)
    getter(<span class="hljs-string">"IAmNull"</span>)
  }</code></pre>
<blockquote>
<p><strong>Все хорошо</strong></p>
<p>Got foo from cache: bar
baz is not in cache!
Got IAmNull from cache: null</p>
</blockquote>
</blockquote>
<h4>10. Объявление методов</h4>
<p>Бонус для тех, кто раньше писал на Scala. Спонсор данного пункта — <a href="https://habrahabr.ru/users/lgorsl/">lgorSL</a>.
<a href="https://habrahabr.ru/post/277479/#comment_8779645">Цитирую:</a></p>
<blockquote>
<p>...
Или, например, синтаксис объявления метода:
В scala: def methodName(...) = {...}
В kotlin возможны два варианта — как в scala (со знаком =) и как в java (без него), но эти два способа объявления неэквивалентны друг другу и работают немного по-разному, я однажды кучу времени потратил на поиск такой «особенности» в коде.
...</p>
</blockquote>
<blockquote>
<p>Я подразумевал следующее:</p>
<p>fun test(){ println(«it works») }
fun test2() = println(«it works too»)
fun test3() = {println(«surprise!»)}</p>
<p>Чтобы вывести «surprise», придётся написать test3()(). Вариант вызова test3() тоже нормально компилируется, только сработает не так, как ожидалось — добавление «лишних» скобочек кардинально меняет логику программы.</p>
<p>Из-за этих граблей переход со скалы на котлин оказался немного болезненным — иногда «по привычке» в объявлении какого-нибудь метода пишу знак равенства, а потом приходится искать ошибки.</p>
</blockquote>
<h4>Заключение</h4>
<p>На этом список наверняка не исчерпывается, поэтому делитесь в комментариях, как вы шли дорогой приключений, но потом что-то пошло не так...
У языка много положительных черт, о которых вы можете прочитать на <a href="http://kotlinlang.org/">официальном сайте</a>, в <a href="https://habrahabr.ru/post/277479/">статьях</a> <a href="https://habrahabr.ru/post/268463/">на</a> <a href="https://habrahabr.ru/post/274997/">хабре</a> и еще много где. Но лично я не согласен с некоторыми архитектурными решениями (классы final by default, java interop) и иногда чувствуется, что языку нехватает единообразия, консистентности. Кроме примера с lateinit Int приведу еще два. Внутри блоков let используем it, внутри with — this, а внутри run, <a href="http://beust.com/weblog/2015/10/30/exploring-the-kotlin-standard-library/">который является комбинацией let и this</a> что надо использовать? А у класса String! можно вызвать методы isBlank(), isNotBlank(), isNullOrBlank(), а «дополняющего» метода вроде isNotNullOrBlank нет:( После Scala нехватает некоторых вещей — Option, Either, matching, каррирования. Но в целом язык оставляет приятное впечатление, надеюсь, что он продолжит достойно развиваться.</p>
<p>P.S. Хабровская подсветка Kotlin хромает, надеюсь, что администрация <a href="https://habrahabr.ru/users/habrahabr/">habrahabr</a> это когда-нибудь поправит...</p>
<h4>UPD: Выстрелы от комментаторов (буду обновлять)</h4>
<p><a href="https://habrahabr.ru/post/278169/#comment_8786835">Неочевидный приоритет оператора elvis</a>. Автор — <a href="https://habrahabr.ru/users/senia/">senia</a>.</p>

      
      <div class="main-content-backlink">
        <hr/>
        <a href='http://kotlin.link/'>&larr; Back to kotlin.link</a>
      </div>
    </div>
  </section>

  <script>
    var menuLink = document.querySelector('.menu-link');

    var listener = function() {
      this.class = 'active';
      this.layout = document.getElementById('layout');
      this.handleEvent = function() {
        this.layout.classList.toggle(this.class);
      };
      this.handleEvent();
    };

    menuLink.addEventListener("click", function(){listener();}, false);
  </script>

  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/github.min.css">
  <!-- Yandex.Metrika counter -->
  <script type="text/javascript">
    (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
        try {
          w.yaCounter35722810 = new Ya.Metrika({id:35722810,
            webvisor:true,
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true});
        } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
        d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
  </script>
  <noscript><div><img src="//mc.yandex.ru/watch/35722810" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
  <!-- /Yandex.Metrika counter -->
</body>
</html>
